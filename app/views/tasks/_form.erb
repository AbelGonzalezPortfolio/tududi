<% action_url = task.new_record? ? '/task/create' : "/task/#{task.id}" %>
<% method = task.new_record? ? 'post' : 'patch' %>

<form action="<%= action_url %>" method="post" class="">
  <% unless task.new_record? %>
    <input type="hidden" name="_method" value="<%= method %>">
  <% end %>
  <fieldset>
    <div class="row mb-3">
      <div class="col-md-12">
        <label for="task_name" class="form-label">Task:</label>
        <input type="text" id="task_name" name="name" value="<%= task.name %>" class="form-control" required>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="task_project" class="form-label">Project (optional):</label>
        <select id="task_project" name="project_id" class="form-select">
          <option value="">No Project</option>
          <% current_user.projects.each do |project| %>
            <option value="<%= project.id %>" <%= 'selected' if task.project_id == project.id %>><%= project.name %></option>
          <% end %>
        </select>
      </div>
      <div class="col-md-4">
        <label for="task_priority" class="form-label">Priority:</label>
        <select id="task_priority" name="priority" class="form-select">
          <option value="Low" <%= 'selected' if task.priority == 'Low' %>>Low</option>
          <option value="Medium" <%= 'selected' if task.priority == 'Medium' %>>Medium</option>
          <option value="High" <%= 'selected' if task.priority == 'High' %>>High</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="task_due_date" class="form-label">Due Date:</label>
        <input type="date" id="task_due_date" name="due_date" value="<%= task.due_date.strftime('%Y-%m-%d') if task.due_date %>" class="form-control">
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="btn btn-primary">
        <%= task.new_record? ? 'Create Task' : 'Update Task' %>
      </button>
      <% unless task.new_record? %>
        <button type="button" class="btn btn-outline-danger" onclick="deleteTask('<%= task.id %>')">
          <i class="bi bi-trash"></i>
        </button>
      <% end %>
    </div>
  </fieldset>
</form>

<% if !task.new_record? %>
  <form id="delete_task_<%= task.id %>" action="/task/<%= task.id %>" method="post" class="d-none">
    <input type="hidden" name="_method" value="delete">
  </form>
<% end %>

<script>
  function deleteTask(taskId) {
    if (confirm('Are you sure you want to delete this task?')) {
      var form = document.getElementById('delete_task_' + taskId);
      form.submit();
    }
  }
</script>
